import{o as u,g as f,b as r,d as U,aE as R,bw as D,j as O,bE as T,F as B,b4 as Z,t as b,l as M,bJ as E,i as j,aL as A,u as s,h as S,bG as q,n as P,c as N,w,a as c,bV as G,T as H,Z as J,e as W,f as K}from"./app-DFNFXxLc.js";import{_ as I}from"./VButton.vue_vue_type_script_setup_true_lang-4xu5Xl2d.js";import{_ as Q}from"./VInput.vue_vue_type_script_setup_true_lang-O9gq6JhU.js";import{u as X,a as Y,_ as ee}from"./NoLayout.vue_vue_type_script_setup_true_lang-DUNHjSsW.js";import{_ as te}from"./ClothesCategoryForm.vue_vue_type_script_setup_true_lang-BWdrJlRX.js";import{_ as L}from"./InputError.vue_vue_type_script_setup_true_lang-CjTXeXq2.js";import{_ as ae}from"./Modal.vue_vue_type_script_setup_true_lang-Cj8KeD00.js";import{_ as se}from"./VPageHeader.vue_vue_type_script_setup_true_lang-D9WX3ZzD.js";import{u as oe}from"./useClothesCategories-CeUMBG1P.js";import{r as F}from"./PlusIcon-OCicvRBO.js";import{r as le}from"./XMarkIcon-BCwhfwNh.js";import"./VNumberInput.vue_vue_type_script_setup_true_lang-Co9H_L84.js";import"./useDressings-Br-h5-jH.js";function re(m,l){return u(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M4.755 10.059a7.5 7.5 0 0 1 12.548-3.364l1.903 1.903h-3.183a.75.75 0 1 0 0 1.5h4.992a.75.75 0 0 0 .75-.75V4.356a.75.75 0 0 0-1.5 0v3.18l-1.9-1.9A9 9 0 0 0 3.306 9.67a.75.75 0 1 0 1.45.388Zm15.408 3.352a.75.75 0 0 0-.919.53 7.5 7.5 0 0 1-12.548 3.364l-1.902-1.903h3.183a.75.75 0 0 0 0-1.5H2.984a.75.75 0 0 0-.75.75v4.992a.75.75 0 0 0 1.5 0v-3.18l1.9 1.9a9 9 0 0 0 15.059-4.035.75.75 0 0 0-.53-.918Z","clip-rule":"evenodd"})])}function ne(m,l){return u(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{d:"M12 9a3.75 3.75 0 1 0 0 7.5A3.75 3.75 0 0 0 12 9Z"}),r("path",{"fill-rule":"evenodd",d:"M9.344 3.071a49.52 49.52 0 0 1 5.312 0c.967.052 1.83.585 2.332 1.39l.821 1.317c.24.383.645.643 1.11.71.386.054.77.113 1.152.177 1.432.239 2.429 1.493 2.429 2.909V18a3 3 0 0 1-3 3h-15a3 3 0 0 1-3-3V9.574c0-1.416.997-2.67 2.429-2.909.382-.064.766-.123 1.151-.178a1.56 1.56 0 0 0 1.11-.71l.822-1.315a2.942 2.942 0 0 1 2.332-1.39ZM6.75 12.75a5.25 5.25 0 1 1 10.5 0 5.25 5.25 0 0 1-10.5 0Zm12-1.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z","clip-rule":"evenodd"})])}const ie=["disabled"],ce=["value","disabled"],de=U({__name:"VSelect",props:R({options:{},disabled:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(m){const l=D(m,"modelValue");return(n,i)=>O((u(),f("select",{disabled:n.disabled,"onUpdate:modelValue":i[0]||(i[0]=o=>l.value=o),class:"flex items-center justify-center gap-1 rounded-lg border-neutral-300 px-4 py-2 ring-offset-2 focus:outline-none focus:ring-4 disabled:pointer-events-none disabled:opacity-50"},[(u(!0),f(B,null,Z(n.options,o=>(u(),f("option",{value:o.value,disabled:o.disabled},b(o.label),9,ce))),256))],8,ie)),[[T,l.value]])}}),ue=({onCamerasUpdated:m,onStream:l})=>{const n=M(-1),{videoInputs:i}=X({requestPermissions:!0}),o=M(!1),p=M();let t=null;E(i,a=>{console.log(a),m&&m(a)});const g=j(()=>i.value[n.value]),d=()=>new Promise((a,$)=>{var z;_(),o.value=!0;const x={audio:!1,video:{deviceId:(z=g.value)==null?void 0:z.deviceId}};navigator.mediaDevices.getUserMedia(x).then(k=>{t=k,l&&l(k),a()}).catch(k=>{p.value=k,console.error(k),$(k)}).finally(()=>{o.value=!1})}),_=()=>t==null?void 0:t.getTracks().forEach(a=>a.stop()),h=async a=>{a<0||i.value.length<=a?n.value=0:n.value=a,await d()},V=()=>h(n.value+1),C=j(()=>i.value.length>1),y=a=>{var $,x;return a&&((($=a.label)==null?void 0:$.includes("rear"))||((x=a.label)==null?void 0:x.includes("back")))},e=async()=>await h(i.value.findIndex(y)),v=j(()=>!y(g.value));return{canSelectNextCamera:C,selectCamera:h,selectRearCamera:e,selectNextCamera:V,startCameraStream:d,stopCameraStream:_,isLoading:o,error:p,isSelectedCameraMirrored:v}},me=m=>{const l=document.createElement("canvas"),n=l.getContext("2d");return{captureFrame:async o=>new Promise((p,t)=>{var _;if(!m.value)return t("No video element");const g=m.value.srcObject;if(!(g instanceof MediaStream))return t("Video srcObject is not a MediaStream");const d=(_=g.getVideoTracks()[0])==null?void 0:_.getSettings();if(!d.width||!d.height)return t("No stream size");if(!n)return t("No context 2d for canvas");l.height=d.height,l.width=d.width,o&&(n.translate(l.width,0),n.scale(-1,1)),n.drawImage(m.value,0,0,d.width,d.height,0,0,d.width,d.height),l.toBlob(h=>p(h))})}},pe={class:"relative w-fit overflow-hidden rounded-md bg-black"},ve={key:0,class:"inset-0 mx-auto object-cover"},fe={class:"absolute bottom-0 z-20 flex w-full flex-row items-end justify-center gap-4 p-4"},ge={key:0,class:"rounded-lg bg-red-100 p-4 text-red-600"},he=U({__name:"Camera",emits:["photo"],setup(m,{emit:l}){const n=l,i=M(),{isLoading:o,error:p,selectNextCamera:t,selectRearCamera:g,canSelectNextCamera:d,stopCameraStream:_,isSelectedCameraMirrored:h}=ue({onCamerasUpdated:()=>{g()},onStream:e=>{i.value&&(i.value.srcObject=e)}}),{captureFrame:V}=me(i),C=async()=>{await t()},y=async()=>{const e=await V(h.value);e&&n("photo",e)};return A(()=>{_()}),(e,v)=>(u(),f("div",pe,[s(o)?(u(),f("div",ve)):S("",!0),O(r("video",{ref_key:"cameraOutputRef",ref:i,class:P(["mx-auto h-full object-contain object-center",s(h)&&"-scale-x-100"]),autoplay:"",muted:""},null,2),[[q,!s(o)]]),r("div",fe,[s(p)?(u(),f("div",ge,b(e.$t("impossible_daccder_la_camra")),1)):S("",!0),s(p)?S("",!0):(u(),N(I,{key:1,icon:"",type:"button",onClick:y},{default:w(()=>[c(s(ne),{class:"size-6"})]),_:1})),!s(p)&&s(d)?(u(),N(I,{key:2,icon:"",variant:"secondary",type:"button",onClick:C},{default:w(()=>[c(s(re),{class:"size-6"})]),_:1})):S("",!0)])]))}}),_e={class:"flex gap-2"},be={class:"flex max-h-[40dvh] justify-center"},we={class:"flex justify-center"},Ce={class:"relative h-full overflow-hidden rounded-md"},ye=["src"],Fe=U({__name:"Create",props:{dressing:{}},setup(m){var y;const l=m,{t:n}=G(),i=oe(),o=j(()=>[...i.optionsWithoutUncategorized,{value:-1,label:n("slectionner_une_categorie"),disabled:!0}]),p=Y("dressing.clothes.create",(y=o.value[0])==null?void 0:y.value),t=H({images:[],description:"",clothes_category_id:p.value}),g=j({get:()=>t.clothes_category_id,set:e=>{p.value=e,t.clothes_category_id=e}}),d=()=>{t.post(route("dressings.clothes.store",l.dressing),{preserveState:!1})},_=e=>{t.images.push(e)},h=e=>{t.images.splice(e,1)},V=e=>(window.URL||window.webkitURL).createObjectURL(e),C=M(!1);return(e,v)=>(u(),f(B,null,[c(s(J),{title:e.$t("dashboard")},null,8,["title"]),c(ee,null,{header:w(()=>[c(se,{"back-to":e.route("dressings.show",e.dressing),title:e.$t("ajouter_un_vtement_au_dressing",{dressing:e.dressing.name})},null,8,["back-to","title"])]),default:w(()=>[r("form",{class:"mx-auto flex h-min w-full max-w-lg flex-col gap-4",onSubmit:K(d,["prevent"])},[r("div",null,[r("label",null,b(e.$t("catgorie")),1),r("div",_e,[o.value.length>1?(u(),N(de,{key:0,modelValue:g.value,"onUpdate:modelValue":v[0]||(v[0]=a=>g.value=a),options:o.value,class:"w-full"},null,8,["modelValue","options"])):S("",!0),c(I,{variant:"tertiary",onClick:v[1]||(v[1]=a=>C.value=!0),icon:o.value.length>1,rounded:!1},{default:w(()=>[c(s(F),{class:"size-5"}),r("span",{class:P({"sr-only":o.value.length>1})},b(e.$t("crer_une_catgorie")),3)]),_:1},8,["icon"])]),c(L,{message:s(t).errors.description,class:"mt-2"},null,8,["message"])]),r("div",null,[r("label",null,b(e.$t("description"))+" ("+b(e.$t("optionnel"))+")",1),c(Q,{modelValue:s(t).description,"onUpdate:modelValue":v[2]||(v[2]=a=>s(t).description=a),placeholder:e.$t("pull_gris"),class:"w-full"},null,8,["modelValue","placeholder"]),c(L,{message:s(t).errors.description,class:"mt-2"},null,8,["message"])]),r("div",null,[r("label",null,b(e.$t("photo"))+" ("+b(e.$t("optionnelle"))+") ",1),r("div",be,[s(t).images.length?(u(!0),f(B,{key:0},Z(s(t).images,(a,$)=>(u(),f("div",we,[r("div",Ce,[r("img",{class:"h-full object-contain",src:V(a),alt:""},null,8,ye),c(I,{icon:"",small:"",class:"absolute right-1 top-1",variant:"danger",onClick:x=>h($)},{default:w(()=>[c(s(le),{class:"h-5 w-5"})]),_:2},1032,["onClick"])])]))),256)):(u(),N(he,{key:1,class:"mx-auto",onPhoto:_}))])]),c(I,{type:"submit",disabled:s(t).processing||s(t).clothes_category_id===-1,loading:s(t).processing},{default:w(()=>[W(b(e.$t("ajouter_le_vtement"))+" ",1),c(s(F),{class:"size-5"})]),_:1},8,["disabled","loading"])],32),c(ae,{show:C.value,onClose:v[3]||(v[3]=a=>C.value=!1)},{default:w(()=>[c(te)]),_:1},8,["show"])]),_:1})],64))}});export{Fe as default};
